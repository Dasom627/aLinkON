<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>LinkON – 이력서 정보 입력</title>
  <link rel="stylesheet" href="../../CSS/Index/register.css"> <!--같은 시트에 있는 CSS파일에 연결한다-->
</head>
<body>
  <div class="wrap">
    <h1>이력서 정보 입력</h1>
    <p class="hint">작성 후 아래 <strong>임시 저장</strong>을 누르면 브라우저에 저장됩니다. 나중에 미리보기 페이지에서 불러와 카드에 채울 수 있어요.</p>

    <form id="resumeForm" class="card" action="#" method="post" novalidate>
      <!-- 기본 정보 -->
      <fieldset>
        <legend>기본 정보</legend>
        <div class="row">
          <div>
            <label for="name">이름</label>
            <input id="name" name="name" type="text" placeholder="홍길동" required />
          </div>
          <div>
            <label for="phone">연락처</label>
            <input id="phone" name="phone" type="text" placeholder="010-1234-5678" required />
          </div>
        </div>
        <div class="row">
          <div>
            <label for="email">이메일</label>
            <input id="email" name="email" type="email" placeholder="user@example.com" required />
          </div>
          <div>
            <label for="site">포트폴리오/사이트(선택)</label>
            <input id="site" name="site" type="url" placeholder="https://myportfolio.me" />
          </div>
        </div>
        <div>
          <label for="summary">한줄 소개/요약 (선택)</label>
          <textarea id="summary" name="summary" placeholder="예: 웹 개발에 강점이 있는 주니어 풀스택 개발자입니다."></textarea>
        </div>
      </fieldset>

      <!-- 학력 -->
      <fieldset>
        <legend>학력</legend>
        <div id="eduList" class="list"></div>
        <div class="toolbar">
          <button type="button" class="btn" id="addEdu">+ 학력 추가</button>
        </div>
      </fieldset>

      <!-- 자격증 -->
      <fieldset>
        <legend>자격증</legend>
        <div id="certList" class="list"></div>
        <div class="toolbar">
          <button type="button" class="btn" id="addCert">+ 자격증 추가</button>
        </div>
      </fieldset>

      <!-- 경력/활동 -->
      <fieldset>
        <legend>경력·활동</legend>
        <div id="expList" class="list"></div>
        <div class="toolbar">
          <button type="button" class="btn" id="addExp">+ 활동 추가</button>
        </div>
      </fieldset>

      <div class="actions">
        <button type="button" class="btn ghost" id="load">불러오기</button>
        <div>
          <button type="button" class="btn" id="clear">초기화</button>
          <button type="submit" class="btn primary">임시 저장</button>
        </div>
      </div>
    </form>
  </div>

  <div id="toast" class="toast" role="status" aria-live="polite">저장되었습니다.</div>

  <template id="eduTpl">
    <div class="item grid-3">
      <div>
        <label>학교/전공</label>
        <input type="text" placeholder="안양대학교 소프트웨어학과" required />
      </div>
      <div>
        <label>기간</label>
        <input type="text" placeholder="2025 ~ 재학" required />
      </div>
      <div>
        <label>비고(선택)</label>
        <input type="text" placeholder="GPA 4.1/4.5" />
      </div>
      <button type="button" class="btn" data-remove>삭제</button>
    </div>
  </template>

  <template id="certTpl">
    <div class="item grid-3">
      <div>
        <label>자격증명</label>
        <input type="text" placeholder="정보처리기능사" required />
      </div>
      <div>
        <label>발급기관</label>
        <input type="text" placeholder="한국산업인력공단" />
      </div>
      <div>
        <label>취득연도</label>
        <input type="text" placeholder="2024" required />
      </div>
      <button type="button" class="btn" data-remove>삭제</button>
    </div>
  </template>

  <template id="expTpl">
    <div class="item">
      <div class="row">
        <div>
          <label>활동/경력명</label>
          <input type="text" placeholder="총학생회 활동 / LinkON MVP 개발" required />
        </div>
        <div>
          <label>기간</label>
          <input type="text" placeholder="2025.03 ~ 진행중" required />
        </div>
      </div>
      <div>
        <label>설명(선택)</label>
        <textarea placeholder="담당 역할, 성과 등을 간단히 적어주세요."></textarea>
      </div>
      <button type="button" class="btn" data-remove>삭제</button>
    </div>
  </template>

  <script>
    // 유틸
    const $ = (s, el=document)=>el.querySelector(s);
    const $$ = (s, el=document)=>Array.from(el.querySelectorAll(s));

    // 리스트 추가/삭제
    function addItem(listId, tplId){
      const list = document.getElementById(listId);
      const node = document.getElementById(tplId).content.cloneNode(true);
      list.appendChild(node);
    }
    function attachRemove(container){
      container.addEventListener('click', (e)=>{
        if(e.target.matches('[data-remove]')){
          const item = e.target.closest('.item');
          item?.remove();
        }
      });
    }

    // 초기 더미 1행씩
    addItem('eduList','eduTpl');
    addItem('certList','certTpl');
    addItem('expList','expTpl');

    // 버튼 바인딩
    document.getElementById('addEdu').onclick = ()=>addItem('eduList','eduTpl');
    document.getElementById('addCert').onclick = ()=>addItem('certList','certTpl');
    document.getElementById('addExp').onclick = ()=>addItem('expList','expTpl');
    attachRemove(document.body);

    // 저장/불러오기
    const toast = document.getElementById('toast');
    function showToast(msg){ toast.textContent = msg; toast.classList.add('show'); setTimeout(()=>toast.classList.remove('show'), 1600); }

    function serialize(){
      const data = {
        name: $('#name').value.trim(),
        phone: $('#phone').value.trim(),
        email: $('#email').value.trim(),
        site: $('#site').value.trim(),
        summary: $('#summary').value.trim(),
        education: $$('#eduList .item').map(item=>{
          const [school, period, note] = $$('input', item).map(i=>i.value.trim());
          return {school, period, note};
        }),
        certificates: $$('#certList .item').map(item=>{
          const [title, org, year] = $$('input', item).map(i=>i.value.trim());
          return {title, org, year};
        }),
        experiences: $$('#expList .item').map(item=>{
          const [title, period] = $$('input', item).map(i=>i.value.trim());
          const desc = $('textarea', item).value.trim();
          return {title, period, desc};
        })
      };
      return data;
    }

    function hydrate(data){
      if(!data) return;
      $('#name').value = data.name || '';
      $('#phone').value = data.phone || '';
      $('#email').value = data.email || '';
      $('#site').value = data.site || '';
      $('#summary').value = data.summary || '';

      // 리스트 재구성
      $('#eduList').innerHTML=''; (data.education||[]).forEach(()=>addItem('eduList','eduTpl'));
      $$('#eduList .item').forEach((item, i)=>{
        const v = data.education[i]; if(!v) return;
        const [a,b,c] = $$('input', item);
        a.value=v.school||''; b.value=v.period||''; c.value=v.note||'';
      });

      $('#certList').innerHTML=''; (data.certificates||[]).forEach(()=>addItem('certList','certTpl'));
      $$('#certList .item').forEach((item, i)=>{
        const v = data.certificates[i]; if(!v) return;
        const [a,b,c] = $$('input', item);
        a.value=v.title||''; b.value=v.org||''; c.value=v.year||'';
      });

      $('#expList').innerHTML=''; (data.experiences||[]).forEach(()=>addItem('expList','expTpl'));
      $$('#expList .item').forEach((item, i)=>{
        const v = data.experiences[i]; if(!v) return;
        const [a,b] = $$('input', item);
        const t = $('textarea', item);
        a.value=v.title||''; b.value=v.period||''; t.value=v.desc||'';
      });
    }

    // 임시 저장
    document.getElementById('resumeForm').addEventListener('submit', (e)=>{
      e.preventDefault();
      const data = serialize();
      localStorage.setItem('linkon_profile', JSON.stringify(data));
      showToast('저장되었습니다. (localStorage)');
    });

    // 불러오기 / 초기화
    document.getElementById('load').onclick = ()=>{
      const raw = localStorage.getItem('linkon_profile');
      if(!raw) return showToast('저장된 데이터가 없습니다.');
      hydrate(JSON.parse(raw));
      showToast('불러왔습니다.');
    };
    document.getElementById('clear').onclick = ()=>{
      document.getElementById('resumeForm').reset();
      // 리스트 초기화 후 기본행 하나씩 생성
      ['eduList','certList','expList'].forEach(id=>document.getElementById(id).innerHTML='');
      addItem('eduList','eduTpl'); addItem('certList','certTpl'); addItem('expList','expTpl');
    };

    // 페이지 진입 시 자동 불러오기(선택)
    const initial = localStorage.getItem('linkon_profile');
    if(initial){ hydrate(JSON.parse(initial)); }
  </script>
</body>
</html>
